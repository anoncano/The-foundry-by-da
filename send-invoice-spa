<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NDIS SPA2-Style Invoice Trigger</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAefBe7cgSA8FNJzR7p5NHWTsbLFrRuyKY",
      authDomain: "the-foundry-by-da.firebaseapp.com",
      projectId: "the-foundry-by-da",
      storageBucket: "the-foundry-by-da.appspot.com",
      messagingSenderId: "825755098252",
      appId: "1:825755098252:web:ad6e84e40be56271fbefa9",
      measurementId: "G-72Z53Z6LNR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.triggerInvoice = async function() {
      const recipientEmail = document.getElementById('emailInput').value;
      if (!recipientEmail) {
        alert("Please enter a recipient email.");
        return;
      }

      // SPA2-style table line items
      const lineItems = [
        {
          date: "2025-07-21",
          support: "Self-Care - Standard",
          itemCode: "01_011_0107_1_1",
          qty: 2,
          rate: 67.56,
          total: 135.12
        },
        {
          date: "2025-07-21",
          support: "Provider Travel - Self Care",
          itemCode: "01_799_0104_1_1",
          qty: 15,
          rate: 0.99,
          total: 14.85
        }
      ];

      await addDoc(collection(db, "spa2InvoiceRequests"), {
        invoiceNumber: `INV-${Date.now()}`,
        createdAt: serverTimestamp(),
        recipientEmail,
        client: {
          fullName: "Peter Pan",
          address: "1 Neverland Ave, Fantasia NSW 2888",
          ndisNumber: "123456789"
        },
        support: {
          fullName: "John Doe",
          abn: "55 123 456 789",
          address: "123 Fake St, Sydney NSW 2000",
          accountName: "John Doe",
          bsb: "012-345",
          accountNumber: "12345678"
        },
        lineItems
      });
      alert("SPA2-style Invoice request created!");
    }
  </script>
</head>
<body>
  <h3>NDIS Invoice (SPA2 Table Format)</h3>
  <input type="email" id="emailInput" placeholder="Recipient Email" required />
  <button onclick="triggerInvoice()">Trigger SPA2-Style Invoice</button>
</body>
</html>
